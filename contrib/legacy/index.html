<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ICd2: Internet Connectivity daemon version 2</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Internet Connectivity daemon version 2</h1>
<p>
<h2><a class="anchor" name="component_responsibility">
Responsibilities of the different components</a></h2>
Responsibility of establishing a network connection is divided between the connectivity library, ICd with its modules and the UI. The connectivity library used by the application creates a D-Bus request and sends it to ICd. ICd processes the request and invokes the UI when necessary. After network connection establishment the connectivity library is informed with the outcome of the network establishment. <p>
The UI can also be invoked without interaction from the connectivity library. In such cases the 'Select connection' dialog is requesting ICd to provide it with and updated view of available networks. ICd will provide the UI with an up to date view of the networks. It is up to the UI design wheter service level ("hotspot") connections are shown with the associated physical networks or wheter the service level connections are collapsed into one entry only. From the displayed connnections the user selects one which the UI requests ICd to try to establish. The connection request to ICd is done using the same methods as are available for the connectivity library.<h2><a class="anchor" name="internal_structure">
Internal structure</a></h2>
ICd2 consists of the following components: <ul>
<li>
A request for a connection to be established is represented by an <a class="el" href="structicd__request.html">icd_request</a> data structure. The request is created when the API calls the <a class="el" href="group__icd__request.html#g40f054686fa97cb2a139c4f2d009e98a">icd_request_new()</a> function. The parameters for this function call are either taken from the scan results or by requesting one of the "any IAPs" (TBD). <p>
The request is passed to the policy API (TBD) that will add one or more candidate IAPs to the request data structure. When the policy has been satisfied, the candidate IAPs are tried one after another with the first successfully established IAP getting selected and any other IAPs removed from the candidate list. <p>
When the IAP has been disconnected, the request data structure is deleted. <p>
See also <a class="el" href="group__icd__request.html">Connection request</a>.<p>
</li>
<li>
The Internet Access Point (IAP) <a class="el" href="structicd__iap.html">icd_iap</a> data structure keeps state information of the network connection being created. The request code iterating through the list of candidate IAPs calls <a class="el" href="group__icd__iap.html#g4c011fa1eb9754b879f28568aa5e1987">icd_iap_connect()</a> for each candidate IAP in order to create one of them. The network connection creation attempt is started using the <a class="el" href="group__icd__iap.html#g1abe9fb0f7ea30b482a7ea3be87522b9">icd_iap_module_next()</a>. Connection creation goes through the link_up, link_post_up and ip_up <a class="el" href="structicd__nw__api.html">icd_nw_api</a> functions in order. <p>
The status callback functions for each <a class="el" href="structicd__nw__api.html">icd_nw_api</a> level can report success in two ways, either with <a class="el" href="group__network__module__api.html#gg5bd2640df31c9d2c116986fe15d97f7d7f4904dddcf9b4c930378ceb0d2415d9">ICD_NW_SUCCESS</a> or <a class="el" href="group__network__module__api.html#gg5bd2640df31c9d2c116986fe15d97f7d67398e510d1457163ddef5cc25fd9326">ICD_NW_SUCCESS_NEXT_LAYER</a>. <a class="el" href="group__network__module__api.html#gg5bd2640df31c9d2c116986fe15d97f7d7f4904dddcf9b4c930378ceb0d2415d9">ICD_NW_SUCCESS</a> allows ICd to search for another network module with lower priority that also provides an *_up function for the same layer as the callback. With <a class="el" href="group__network__module__api.html#gg5bd2640df31c9d2c116986fe15d97f7d67398e510d1457163ddef5cc25fd9326">ICD_NW_SUCCESS_NEXT_LAYER</a> the module can force ICd to go directly to the next layer above the one whose callback just got called. When <a class="el" href="group__network__module__api.html#gg5bd2640df31c9d2c116986fe15d97f7dad0a088d56bdd5f1bc478b760ddb6261">ICD_NW_RESTART</a> is reported, the IAP will close down and then immediately created again. <p>
Disconnecting an IAP happens when the status callback reports error or when the network module spontaneously needs to bring down a connection using <a class="el" href="group__network__module__api.html#g030928ea9d35db59639580cbdb2a2fb3">icd_nw_close_fn()</a>. The latter case is reserved for a connected IAP; while the IAP is being connected the callback is the preferred method for reporting an error event leading to disconnection. When disconnecting, link_down, link_pre_down and link_down <a class="el" href="structicd__nw__api.html">icd_nw_api</a> functions are called in reverse order for those modules whose respective _up functions got called on connect. Has the module not yet called the given callback when disconnect is started, the _down function for the respective level and module will be called. <p>
See also <a class="el" href="group__icd__iap.html">IAP connection abstraction</a>.<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>draw the IAP state diagram and insert it here </dd></dl>
<p>
<p>
</li>
<li>
Any part of ICd interested in scan results registers a scan callback with <a class="el" href="group__icd__scan.html#gf12a52cf689328fd051c10b9705ecaf4">icd_scan_results_request()</a>. Scanned elements that already are in the cache will be received by the callback immediately. As new scan results appear, they will be provided to the callback. Expiry and updated results are also indicated, see the enum <a class="el" href="group__dbus__api.html#g8686ca765f1a7913b2e5e062314e6d2f">icd_scan_status</a>. Scanning will go on as long as there is any listeners registered, the rescan interval and cache expiry are dictated by the corresponding module. A rescan will not be performed if there are no listeners when the rescan timer expires. <p>
See also <a class="el" href="group__icd__scan.html">Network scan and scan result handling</a>. </li>
</ul>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Thu Mar 11 09:04:50 2010 for ICd2 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
